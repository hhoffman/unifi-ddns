# Cloudflare DDNS Configuration Example
# Copy this file to config.yaml and fill in your values

# UniFi Controller Configuration (optional - only needed if using 'device' IP source)
unifi:
  # UDM Pro hostname or IP address
  host: "192.168.1.1"

  # UniFi Controller port (default: 443)
  port: 443

  # Site name (default is usually "default")
  site: "default"

  # Authentication method 1: API Key (Recommended)
  # Generate at: Settings → Admins → [Your User] → API Keys
  api_key: "your_unifi_api_key_here"

  # Authentication method 2: Username/Password (if no API key)
  # Uncomment and use if your controller doesn't support API keys
  # username: "admin"
  # password: "your_password_here"

  # Verify SSL certificate (set to false for self-signed certs)
  verify_ssl: false

# Cloudflare API Configuration
cloudflare:
  # API token with the following permissions for your domain:
  # - Zone:Read (to lookup zone ID)
  # - DNS:Read (to check existing records)
  # - DNS:Edit (to create/update records)
  # Create at: https://dash.cloudflare.com/profile/api-tokens
  api_token: "your_cloudflare_api_token_here"

  # Alternative: use environment variable
  # api_token_env: "CF_API_TOKEN"

# External IP Service Configuration (optional - for 'wan' IP source)
external_ip:
  ipv4_url: "https://api.ipify.org"     # Service that returns your public IPv4
  ipv6_url: "https://api6.ipify.org"    # Service that returns your public IPv6

# Logging Configuration
logging:
  level: INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  file: /app/logs/ddns.log  # Use /app/logs in Docker
  max_bytes: 10485760  # 10MB
  backup_count: 5
  format: json  # json or text

# DNS Update Settings
settings:
  ttl: 120  # DNS TTL in seconds (120 = 2 minutes, good for dynamic IPs)
  only_update_if_changed: true  # Skip API call if IP hasn't changed

# Device to DNS Record Mappings
#
# IP Source Options:
#   ipv4: wan      - Use public IPv4 from external service (ipify.org)
#   ipv4: device   - Use device's IPv4 from UniFi (requires MAC) - usually private IP
#   ipv4: true     - Same as 'device' (backward compatible)
#   ipv4: false    - Don't create A record (or omit the field)
#
#   ipv6: wan      - Use public IPv6 from external service (api6.ipify.org)
#   ipv6: device   - Use device's IPv6 from UniFi (requires MAC)
#   ipv6: true     - Same as 'device' (backward compatible)
#   ipv6: false    - Don't create AAAA record (or omit the field)
#
#   cname: "target.hostname.com" - Create CNAME record (cannot be used with ipv4/ipv6)
#
# Notes:
#   - 'mac' is only required when using 'device' (or true) as IP source
#   - CNAME records cannot coexist with A/AAAA records on the same hostname

devices:
  # Example 1: Main domain using WAN IPs from external service (no MAC needed)
  - name: "Main Domain"
    records:
      - domain: example.com
        hostname: example.com
        ipv4: wan       # Public IPv4 from ipify.org
        ipv6: wan       # Public IPv6 from api6.ipify.org

  # Example 2: Server behind NAT - WAN IPv4, device IPv6 from UniFi
  - mac: "aa:bb:cc:dd:ee:ff"
    name: "Docker Server 00"
    records:
      - domain: example.com
        hostname: docker-00.example.com
        ipv4: wan       # Public IPv4 (same for all NAT'd devices)
        ipv6: device    # Device's IPv6 from UniFi

  # Example 3: Another server with same pattern
  - mac: "11:22:33:44:55:66"
    name: "Docker Server 01"
    records:
      - domain: example.com
        hostname: docker-01.example.com
        ipv4: wan       # Public IPv4
        ipv6: device    # Device's IPv6 from UniFi

  # Example 4: CNAME alias (no MAC needed, no IP lookups)
  - name: "WWW Alias"
    records:
      - domain: example.com
        hostname: www.example.com
        cname: "example.com"   # Points to main domain

  # Example 5: Device with only IPv6 (IPv6-only network)
  - mac: "22:33:44:55:66:77"
    name: "IPv6 Only Server"
    records:
      - domain: example.com
        hostname: v6only.example.com
        ipv6: device    # Only AAAA record

  # Example 6: Legacy config (backward compatible - 'true' means 'device')
  - mac: "33:44:55:66:77:88"
    name: "Legacy Config Server"
    records:
      - domain: example.com
        hostname: legacy.example.com
        ipv4: true      # Same as 'device' - gets IP from UniFi
        ipv6: true      # Same as 'device' - gets IP from UniFi

  # Example 7: Multiple hostnames for one device
  - mac: "44:55:66:77:88:99"
    name: "Multi-hostname Server"
    records:
      # Primary hostname
      - domain: example.com
        hostname: server.example.com
        ipv4: wan
        ipv6: device

      # API subdomain (same IPs)
      - domain: example.com
        hostname: api.example.com
        ipv4: wan
        ipv6: device

      # Admin alias (CNAME to primary)
      - domain: example.com
        hostname: admin.example.com
        cname: "server.example.com"
